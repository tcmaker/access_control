<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TCMaker Welcome Screen</title>
    <link href="../static/bootstrap.min.css" rel="stylesheet">
    <link href="{{ url_for('static',filename='bootstrap.min.css') }}" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'League Spartan';
            src:
                url("{{ url_for('static', filename='leaguespartan-bold.eot')}}");
            src:
                url("{{ url_for('static', filename='leaguespartan-bold.woff')}}") format("woff"),
                url("{{ url_for('static', filename='leaguespartan-bold.woff2')}}") format("woff2"),
                url("{{ url_for('static', filename='leaguespartan-bold.eot#iefix')}}") format("embedded-opentype"),
                url("{{ url_for('static', filename='leaguespartan-bold.ttf')}}") format("truetype"),
                url("{{ url_for('static', filename='leaguespartan-bold.svg#league_spartanbold')}}") format("svg");

            font-weight: bold;
            font-style: normal; }

        html, body {
            font-size: larger;
            font-family: "League Spartan", "Palatino Linotype", Palatino, "Book Antiqua", Georgia, serif;
            height: 93%; /*vh;*/
            --bs-bg-opacity:1;
            background-color:rgba(var(--bs-light-rgb),var(--bs-bg-opacity))!important
        }
        /*font-family-sans-serif: "Helvetica Neue", Arial, Helvetica, Roboto, sans-serif;
        font-family-monospace: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;*/
    }


     .clock {
            position: absolute;
            top: 5vmin;
            right: 5vmin;
            /*transform: translateX(-50%) translateY(-50%);*/
            color: black;
            /*font-size: 60px;*/
            font-family: "League Spartan";
            letter-spacing: 7px;
        }
     #clockDisplay {
         /*font-size: 250%;*/
     }

</style>
</head>
<body>
<div class="container-fluid px-3 py-5 h-100 bg-light">
<div class="row mb-3 justify-content-between">
    <div class="col-7">
<img src="{{ url_for('static',filename='logo-red-text.svg') }}"
    alt="TC Maker Logo" />
    </div>
    <div id="clockDisplay" class="col-4" onload="showTime()">
        <div class="row justify-content-end">
            <div class="col">
                <span class="h1 display-4" id="timedisplay">12:23</span>
                <span class="h5 display-5" id="seconddisplay" style="vertical-align: top">44</span>
            </div>
        </div>
        <div class="row">
            <div class="col" >
                <h5 id="datedisplay">Tuesday</h5>
            </div>
        </div>
    </div>
</div>
    <div class="row h-100">
<div id="updateTargets" >
    {% include 'welcome.html' %}
    {% include 'expired.html' %}
    {% include 'unrecognized.html' %}
    {% include 'idle.html' %}
</div>
</div>
</div>


<script src="{{  url_for('static',filename='jquery.min.js') }}"></script>
<script type="application/javascript">
var isActive = true;
$().ready(function () {
    pollServer();
})

function pollServer()
{
    var divs = ["#expiredcontent","#welcomecontent","#unrecognizedcontent","#idlecontent"];
    if(isActive)
    {
        $.ajax({
            url: "{{  url_for('longpoll') }}",
            type: "GET",
            success: function(r) {
                console.log("result from server:" + r);
                //result = JSON.parse(r);
                var newContent = r.content;
                var oldContent = "";
                for(const d of divs) {
                    if($(d).css('display') !== 'none'){
                        oldContent = d;
                        break;
                    }
                }

                var duration = 250;
                if(newContent === "#idlecontent") {
                    duration = 1500;
                }
                if(oldContent !== newContent) {
                    $(oldContent).fadeOut(duration, function () {
                        $(newContent).fadeIn();
                    });
                }
                if(newContent === "#unrecognizedcontent") {
                    $("#fobcontents").text(r.fob)
                }
                else{
                    $("#fobcontents").text("")
                }

                //$("#updateTarget").html(result)
                pollServer();
            },
            error: function() {
                pollServer();
            },
            timeout: 60000})
    }
}

function showTime(){
    var date = new Date();
    var h = date.getHours(); // 0 - 23
    var m = date.getMinutes(); // 0 - 59
    var s = date.getSeconds(); // 0 - 59
    var d = date.getDay()

    h = (h < 10) ? "0" + h : h;
    m = (m < 10) ? "0" + m : m;
    s = (s < 10) ? "0" + s : s;

    var time = h + ":" + m;
    var seconds = s
    var date = date.toLocaleDateString("en-US", {weekday:'long', month: 'long', day: 'numeric'})

    document.getElementById("timedisplay").innerText = time;
    document.getElementById("timedisplay").textContent = time;

    document.getElementById("seconddisplay").innerText = seconds;
    document.getElementById("seconddisplay").textContent = seconds;

    document.getElementById("datedisplay").innerText = date;
    document.getElementById("datedisplay").textContent = date;
    setTimeout(showTime, 1000);
}
showTime();
</script>
</body>
</html>
